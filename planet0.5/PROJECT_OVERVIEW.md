# 项目框架介绍 (Project Framework Overview)

本项目是一个基于 WebGL (Three.js) 的 3D 星球探索游戏/演示。项目主要包含以下几个核心模块和文件夹结构。

## 1. 目录结构

*   **根目录** (`d:\GitProject\dogEleven.github.io\`)
    *   `planet.html/`: 核心游戏逻辑旧目录。
    *   `planetsoc/`: **当前核心开发目录**。
        *   `index.html`: **主程序文件**。包含了所有的游戏逻辑、渲染代码、AI系统和 HTML 结构。
    *   `.agent/`: AI 助手的工作流和配置文件。

## 2. 技术栈

*   **核心引擎**: [Three.js (r128)](https://threejs.org/)
*   **语言**: 原生 HTML5, CSS3, JavaScript (ES6+)。
*   **着色器**: GLSL (自定义星球地形、材质、植被和水体)。

## 3. 核心功能模块 (`planetsoc/index.html`)

### A. 渲染与环境 (Rendering & Environment)
*   **场景**: 3D 星球场景，CSS 渐变深空背景。
*   **特效**:
    *   **粒子系统**: 通用爆炸/烟尘系统。支持跳跃扬尘 (Jump Dust - 慢速烟雾) 和 死亡特效 (Death Explosion - 向上飘散)。
    *   **迷雾**: 距离场迷雾，融合天空颜色。

### B. 程序化与地形 (Procedural Generation)
*   **地形**: 基于噪声 (Noise) 的顶点置换，生成山脉与平原。
*   **道路**: 程序化生成的环球道路，地形自动压平适配。
*   **植被**: 实例化渲染 (InstancedMesh) 的草地、树木、蘑菇、花朵。
    *   **资源再生**: 采集后的资源 (石头、蘑菇) 会每 5 秒自动随机刷新 3 到 10 个物品。

### C. 实体与 AI 系统 (Entities & AI)

#### 1. 玩家 (Player)
*   **控制**: 键盘 (WASD+空格) 或 移动端虚拟摇杆。
*   **物理**: 自定义球体引力物理，支持跳跃、水浮力。
*   **交互**: 拾取物品，且跳跃时产生烟尘特效。

#### 2. 跟随者 (Followers / NPCs)
*   **行为**: 
    *   自动跟随玩家。
    *   **跳跃同步**: 当玩家跳跃时，所有跟随者同步跳跃。
    *   **重生机制**: 死亡后会在宝箱附近自动重生，保持种群数量。
*   **交互**: 可被狼攻击，死亡后掉落粒子效果。

#### 3. 敌人 - 狼 (Wolves)
*   **AI 状态机**:
    *   **Wander**: 随机游荡，避开水源。
    *   **Circle**: 发现目标 (玩家或跟随者) 后环绕奔跑。
    *   **Dash/Bite**: 快速冲刺并进行跳跃撕咬攻击。
*   **战斗**: 
    *   一次攻击狂热 (Frenzy) 可连续击杀最多 5 个跟随者。
    *   具备受击反馈和独立的碰撞逻辑。

#### 4. 宝箱 (Chest)
*   **功能**: 全局仓库。玩家靠近自动存入物品。
*   **UI**: 浮动气泡显示当前库存统计。

### D. 摄像机系统
*   **智能跟随**: 相机平滑跟随玩家，自动调整高度和距离。
*   **动态视角**: 根据玩家动作 (如跳跃) 保持稳定的观察角度。

## 4. 更新日志 (Recent Updates)
*   **Jump Sync**: 修复了跟随者跳跃不同步的问题。
*   **Visuals**: 优化了跳跃烟尘 (Transparent Smoke) 和死亡特效。
*   **Game Loop**: 引入了 5秒 资源随机再生循环 (每次 3-10 个)。
*   **Combat**: 强化了狼的攻击能力 (AOE/Multi-kill potential)。
*   **Chest**: 增加了宝箱升级系统 (Dormitory Upgrade System)。
    *   Level 1 -> Level 2: 需收集 10 树枝 + 10 蘑菇。升级后人口上限提升至 10，外观变为双层木屋。
    *   Level 2 Task: 需收集 15 石头 + 15 蘑菇。

---
*文档生成时间: 2025-12-18*
